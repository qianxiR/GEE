# Google Earth Engine (GEE) 认证指南

## 目录
1. [前置准备](#前置准备)
2. [方式一：Code Editor 认证（推荐）](#方式一code-editor-认证推荐)
3. [方式二：Python API 认证](#方式二python-api-认证)
4. [连接测试](#连接测试)
5. [常见问题](#常见问题)

---

## 前置准备

### 1. 注册 GEE 账号

**步骤：**
1. 访问 GEE 官网：https://earthengine.google.com/
2. 点击 **Sign Up** 或 **Get Started**
3. 使用 **Google 账号**登录（推荐使用 Gmail 邮箱）
4. 填写申请表单：
   - 选择用途：`Research`（科研）或 `Education`（教育）
   - 填写项目描述：简要说明研究方向（如：水体提取、环境监测等）
   - 填写机构信息（可选）

**审核时间：** 通常 1-3 天，最快几小时

**审核通过标志：** 收到 Google 邮件通知，标题为 "Welcome to Google Earth Engine"

---

## 方式一：Code Editor 认证（推荐）

### 适用场景
- 快速原型开发
- 数据可视化
- 不需要本地编程环境
- **本项目的 JavaScript 脚本均使用此方式**

### 认证步骤

#### 1. 打开 Code Editor
访问：https://code.earthengine.google.com/

#### 2. 自动登录
- 使用已注册的 Google 账号登录
- **无需额外认证步骤**，登录即可使用

#### 3. 验证连接
在 Code Editor 中运行以下代码：

```javascript
// 验证 GEE 连接
print('GEE 连接成功！');
print('当前用户:', ee.String(ee.user.email()));

// 测试数据访问
var image = ee.Image('NASA/NASADEM_HGT/001');
print('数据访问成功:', image);
```

点击 **Run** 按钮，如果控制台输出结果，则连接成功。

#### 4. 运行项目脚本
直接复制本项目中的 `.js` 文件内容到 Code Editor：
- `数据下载/按省或区下载数据.js`
- `水体提取算法/lene.js`
- `水体提取算法/songhuajiang.js`

---

## 方式二：Python API 认证

### 适用场景
- 本地开发和调试
- 批量处理和自动化任务
- 集成到 Python 数据分析流程
- 需要使用 Jupyter Notebook

### 认证步骤

#### 1. 安装 Python 包

```bash
# 安装 earthengine-api
pip install earthengine-api

# 或使用清华镜像源（国内推荐）
pip install earthengine-api -i https://pypi.tuna.tsinghua.edu.cn/simple
```

**依赖要求：**
- Python 3.7 或更高版本
- pip 最新版本

#### 2. 执行认证命令

```bash
earthengine authenticate
```

**认证流程：**
1. 命令会自动打开浏览器
2. 登录 Google 账号（使用已注册 GEE 的账号）
3. 授权应用访问 GEE
4. 获取验证码（Authorization Code）
5. 将验证码粘贴回终端
6. 认证完成

**认证信息存储位置：**
- Windows: `C:\Users\<用户名>\.config\earthengine\credentials`
- Linux/Mac: `~/.config/earthengine/credentials`

#### 3. 使用认证脚本（自动化）

运行本目录下的 `python_认证.py` 脚本：

```bash
cd 认证
python python_认证.py
```

脚本会自动执行认证流程并保存凭据。

---

## 连接测试

### Python 连接测试

运行 `测试连接.py` 脚本：

```bash
cd 认证
python 测试连接.py
```

**预期输出：**
```
==================== GEE 连接测试 ====================
✓ GEE 初始化成功
✓ 用户邮箱: your_email@gmail.com
✓ 数据访问成功
✓ 影像信息: {'type': 'Image', 'bands': [...]}
====================================================
✅ 所有测试通过，GEE 连接正常！
```

### JavaScript 连接测试

在 Code Editor 中运行：

```javascript
// 测试影像数据访问
var S2 = ee.ImageCollection("COPERNICUS/S2_SR_HARMONIZED")
  .filterDate('2024-01-01', '2024-01-31')
  .first();

print('Sentinel-2 影像:', S2);
Map.addLayer(S2, {min: 0, max: 3000, bands: ['B4', 'B3', 'B2']}, 'Test Image');
```

---

## 常见问题

### Q1: 注册后多久能使用？
**A:** 通常 1-3 天内会收到审核结果邮件。如果超过 7 天未收到回复，可以尝试重新提交申请。

### Q2: 认证时浏览器无法打开怎么办？
**A:** 
```bash
# 使用无头模式认证
earthengine authenticate --quiet
```
然后手动访问终端输出的 URL 完成认证。

### Q3: 中国大陆用户网络问题
**A:** 
- 需要稳定的国际网络连接访问 Google 服务
- 建议使用学校或研究机构的网络
- 认证完成后，GEE API 调用相对稳定

### Q4: Python 认证失败：`EEException: Invalid JSON`
**A:** 
```bash
# 清除旧的认证信息
rm ~/.config/earthengine/credentials  # Linux/Mac
del %USERPROFILE%\.config\earthengine\credentials  # Windows

# 重新认证
earthengine authenticate
```

### Q5: Code Editor 显示 "User memory limit exceeded"
**A:** 
- 减小处理区域范围
- 降低输出分辨率（增大 scale 参数）
- 使用 `Export` 任务导出到 Google Drive

### Q6: 如何上传自定义数据资产？
**A:** 
1. 在 Code Editor 左侧点击 **Assets** 标签
2. 点击 **NEW** → **Upload**
3. 选择文件类型（Shapefile、GeoTIFF 等）
4. 上传后会生成资产路径，如：`projects/your-project/assets/your-asset`

### Q7: Tasks 任务一直处于 "READY" 状态
**A:** 
- 点击任务右侧的 **RUN** 按钮启动任务
- 确认弹窗中的参数无误后再次点击 **RUN**

### Q8: Python 脚本运行缓慢
**A:** 
- GEE 使用云端计算，本地只发送请求
- 使用 `.getInfo()` 会触发计算并下载结果，尽量减少使用
- 大规模计算使用 `Export` 导出到 Drive

---

## 资源链接

- **GEE 官网**: https://earthengine.google.com/
- **Code Editor**: https://code.earthengine.google.com/
- **官方文档**: https://developers.google.com/earth-engine/
- **Python API 文档**: https://developers.google.com/earth-engine/guides/python_install
- **数据目录**: https://developers.google.com/earth-engine/datasets/

---

## 技术支持

如果遇到问题，可以：
1. 查阅 GEE 官方文档
2. 访问 GEE 开发者论坛：https://groups.google.com/g/google-earth-engine-developers
3. 检查本项目的其他脚本示例

---

**最后更新时间：** 2025-10-14

